import hashlib
import os

def calculate_hash(file_path):
    """–°—á–∏—Ç–∞–µ—Ç SHA256 —Ö–µ—à —Ñ–∞–π–ª–∞"""
    sha256_hash = hashlib.sha256()
    
    # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ ('rb'), —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç—ã, –Ω–æ –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏/–±–∞–∑—ã
    with open(file_path, "rb") as f:
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫—É—Å–∫–∞–º–∏ –ø–æ 4 –∫–∏–ª–æ–±–∞–π—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–±–∏—Ç—å –ø–∞–º—è—Ç—å, –µ—Å–ª–∏ —Ñ–∞–π–ª –æ–≥—Ä–æ–º–Ω—ã–π)
        for byte_block in iter(lambda: f.read(4096), b""):
            sha256_hash.update(byte_block)
            
    return sha256_hash.hexdigest()

def run_integrity_test():
    filename = "test_data.bin"
    
    # 1. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏ –ø–∏—à–µ–º —Ç—É–¥–∞ —Å–ª—É—á–∞–π–Ω—ã–π –º—É—Å–æ—Ä (1024 –±–∞–π—Ç–∞)
    print("1. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª...")
    with open(filename, "wb") as f:
        f.write(os.urandom(1024))
        
    # 2. –°—á–∏—Ç–∞–µ–º —Ö–µ—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    original_hash = calculate_hash(filename)
    print(f"–•–µ—à –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: {original_hash}")
    
    # 3. –ò–º–∏—Ç–∏—Ä—É–µ–º '–ø–æ—Ä—á—É –¥–∞–Ω–Ω—ã—Ö' (–±–∏—Ç—ã–π —Å–µ–∫—Ç–æ—Ä –∏–ª–∏ —Å–±–æ–π –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ)
    print("2. –ü–æ—Ä—Ç–∏–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ (–±–∏—Ç—ã–π –±–∞–π—Ç)...")
    with open(filename, "r+b") as f: # r+b = —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –±–∏–Ω–∞—Ä–Ω–æ
        f.seek(10) # –í—Å—Ç–∞–µ–º –Ω–∞ 10-–π –±–∞–π—Ç
        f.write(b'\xFF') # –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ
        
    # 4. –°–Ω–æ–≤–∞ —Å—á–∏—Ç–∞–µ–º —Ö–µ—à
    corrupted_hash = calculate_hash(filename)
    print(f"–•–µ—à –±–∏—Ç–æ–≥–æ:    {corrupted_hash}")
    
    # 5. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º
    if original_hash == corrupted_hash:
        print("üî¥ –ü–†–û–í–ê–õ: –•–µ—à–∏ —Å–æ–≤–ø–∞–ª–∏, –º—ã –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏ –ø–æ–¥–º–µ–Ω—ã!")
    else:
        print("üü¢ –£–°–ü–ï–•: –•–µ—à–∏ —Ä–∞–∑–Ω—ã–µ. –°–∏—Å—Ç–µ–º–∞ –∑–∞–º–µ—Ç–∏–ª–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.")

    # –£–¥–∞–ª—è–µ–º –º—É—Å–æ—Ä –∑–∞ —Å–æ–±–æ–π
    if os.path.exists(filename):
        os.remove(filename)

if __name__ == "__main__":
    run_integrity_test()